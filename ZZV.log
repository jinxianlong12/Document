WITH 
	PRD AS(
		SELECT
(SELECT COUNT(LOT_ID) FROM LOT_TRACES WHERE trunc(CREATED_AT)=trunc(Sysdate) AND OPERATION_ID='1-OP2010') AS PRD_OP2010,
(SELECT COUNT(LOT_ID) FROM LOT_TRACES WHERE trunc(CREATED_AT)=trunc(Sysdate) AND OPERATION_ID='1-OP2020') AS PRD_OP2020,
(SELECT COUNT(LOT_ID) FROM LOT_TRACES WHERE trunc(CREATED_AT)=trunc(Sysdate) AND OPERATION_ID='1-OP2031') AS PRD_OP2031,
(SELECT COUNT(LOT_ID) FROM LOT_TRACES WHERE trunc(CREATED_AT)=trunc(Sysdate) AND OPERATION_ID='1-OP2050') AS PRD_OP2050,
(SELECT COUNT(LOT_ID) FROM LOT_TRACES WHERE trunc(CREATED_AT)=trunc(Sysdate) AND OPERATION_ID='1-OP2060') AS PRD_OP2060,
(SELECT COUNT(LOT_ID) FROM LOT_TRACES WHERE trunc(CREATED_AT)=trunc(Sysdate) AND OPERATION_ID='1-OP2070') AS PRD_OP2070,
(SELECT COUNT(LOT_ID) FROM LOT_TRACES WHERE trunc(CREATED_AT)=trunc(Sysdate) AND OPERATION_ID='1-OP2080') AS PRD_OP2080,
(SELECT COUNT(LOT_ID) FROM LOT_TRACES WHERE trunc(CREATED_AT)=trunc(Sysdate) AND OPERATION_ID='1-OP2090') AS PRD_OP2090,
(SELECT COUNT(LOT_ID) FROM LOT_TRACES WHERE trunc(CREATED_AT)=trunc(Sysdate) AND OPERATION_ID='1-OP2100') AS PRD_OP2100,
(SELECT COUNT(LOT_ID) FROM LOT_TRACES WHERE trunc(CREATED_AT)=trunc(Sysdate) AND OPERATION_ID='1-OP2110') AS PRD_OP2110
FROM DUAL
	),BAD AS(
	SELECT
(SELECT COUNT(LOT_ID) FROM LOT_DEFECTS WHERE trunc(CREATED_AT)=trunc(Sysdate) AND SEED_OPERATION_ID='1-OP2010') AS BAD_OP2010,
(SELECT COUNT(LOT_ID) FROM LOT_DEFECTS WHERE trunc(CREATED_AT)=trunc(Sysdate) AND SEED_OPERATION_ID='1-OP2020') AS BAD_OP2020,
(SELECT COUNT(LOT_ID) FROM LOT_DEFECTS WHERE trunc(CREATED_AT)=trunc(Sysdate) AND SEED_OPERATION_ID='1-OP2031') AS BAD_OP2031,
(SELECT COUNT(LOT_ID) FROM LOT_DEFECTS WHERE trunc(CREATED_AT)=trunc(Sysdate) AND SEED_OPERATION_ID='1-OP2050') AS BAD_OP2050,
(SELECT COUNT(LOT_ID) FROM LOT_DEFECTS WHERE trunc(CREATED_AT)=trunc(Sysdate) AND SEED_OPERATION_ID='1-OP2060') AS BAD_OP2060,
(SELECT COUNT(LOT_ID) FROM LOT_DEFECTS WHERE trunc(CREATED_AT)=trunc(Sysdate) AND SEED_OPERATION_ID='1-OP2070') AS BAD_OP2070,
(SELECT COUNT(LOT_ID) FROM LOT_DEFECTS WHERE trunc(CREATED_AT)=trunc(Sysdate) AND SEED_OPERATION_ID='1-OP2080') AS BAD_OP2080,
(SELECT COUNT(LOT_ID) FROM LOT_DEFECTS WHERE trunc(CREATED_AT)=trunc(Sysdate) AND SEED_OPERATION_ID='1-OP2090') AS BAD_OP2090,
(SELECT COUNT(LOT_ID) FROM LOT_DEFECTS WHERE trunc(CREATED_AT)=trunc(Sysdate) AND SEED_OPERATION_ID='1-OP2100') AS BAD_OP2100,
(SELECT COUNT(LOT_ID) FROM LOT_DEFECTS WHERE trunc(CREATED_AT)=trunc(Sysdate) AND SEED_OPERATION_ID='1-OP2110') AS BAD_OP2110
FROM DUAL
	),PLAN AS(
	SELECT
NVL((SELECT PLAN_QTY FROM WORK_ORDERS WHERE trunc(CREATED_AT)=trunc(Sysdate) AND ROUTING_ID='1-EOL_TEST'),0) AS PLAN_QTY
FROM DUAL
	)

SELECT 
	PRD.PRD_OP2010 AS PRD_OP2010,
	PRD.PRD_OP2020 AS PRD_OP2020,
	PRD.PRD_OP2031 AS PRD_OP2031,
	PRD.PRD_OP2050 AS PRD_OP2050,
	PRD.PRD_OP2060 AS PRD_OP2060,
	PRD.PRD_OP2070 AS PRD_OP2070,
	PRD.PRD_OP2080 AS PRD_OP2080,
	PRD.PRD_OP2090 AS PRD_OP2090,
	PRD.PRD_OP2100 AS PRD_OP2100,
	PRD.PRD_OP2110 AS PRD_OP2110,
	
	BAD.BAD_OP2010 AS BAD_OP2010,
	BAD.BAD_OP2020 AS BAD_OP2020,
	BAD.BAD_OP2031 AS BAD_OP2031,
	BAD.BAD_OP2050 AS BAD_OP2050,
	BAD.BAD_OP2060 AS BAD_OP2060,
	BAD.BAD_OP2070 AS BAD_OP2070,
	BAD.BAD_OP2080 AS BAD_OP2080,
	BAD.BAD_OP2090 AS BAD_OP2090,
	BAD.BAD_OP2100 AS BAD_OP2100,
	BAD.BAD_OP2110 AS BAD_OP2110,
	
	CASE WHEN PLAN.PLAN_QTY = 0 OR PLAN.PLAN_QTY IS NULL THEN 100.0
	ELSE ROUND(PRD.PRD_OP2010 * 100 / PLAN.PLAN_QTY, 2)END AS RATE_OP2010,
	
	CASE WHEN PLAN.PLAN_QTY = 0 OR PLAN.PLAN_QTY IS NULL THEN 100.0
	ELSE ROUND(PRD.PRD_OP2020 * 100 / PLAN.PLAN_QTY, 2)END AS RATE_OP2020,
	
	CASE WHEN PLAN.PLAN_QTY = 0 OR PLAN.PLAN_QTY IS NULL THEN 100.0
	ELSE ROUND(PRD.PRD_OP2031 * 100 / PLAN.PLAN_QTY, 2)END AS RATE_OP2031,
	
	CASE WHEN PLAN.PLAN_QTY = 0 OR PLAN.PLAN_QTY IS NULL THEN 100.0
	ELSE ROUND(PRD.PRD_OP2050 * 100 / PLAN.PLAN_QTY, 2)END AS RATE_OP2050,
	
	CASE WHEN PLAN.PLAN_QTY = 0 OR PLAN.PLAN_QTY IS NULL THEN 100.0
	ELSE ROUND(PRD.PRD_OP2060 * 100 / PLAN.PLAN_QTY, 2)END AS RATE_OP2060,
	
	CASE WHEN PLAN.PLAN_QTY = 0 OR PLAN.PLAN_QTY IS NULL THEN 100.0
	ELSE ROUND(PRD.PRD_OP2070 * 100 / PLAN.PLAN_QTY, 2)END AS RATE_OP2070,
	
	CASE WHEN PLAN.PLAN_QTY = 0 OR PLAN.PLAN_QTY IS NULL THEN 100.0
	ELSE ROUND(PRD.PRD_OP2080 * 100 / PLAN.PLAN_QTY, 2)END AS RATE_OP2080,
	
	CASE WHEN PLAN.PLAN_QTY = 0 OR PLAN.PLAN_QTY IS NULL THEN 100.0
	ELSE ROUND(PRD.PRD_OP2090 * 100 / PLAN.PLAN_QTY, 2)END AS RATE_OP2090,
	
	CASE WHEN PLAN.PLAN_QTY = 0 OR PLAN.PLAN_QTY IS NULL THEN 100.0
	ELSE ROUND(PRD.PRD_OP2100 * 100 / PLAN.PLAN_QTY, 2)END AS RATE_OP2100,
	
	CASE WHEN PLAN.PLAN_QTY = 0 OR PLAN.PLAN_QTY IS NULL THEN 100.0
	ELSE ROUND(PRD.PRD_OP2110 * 100 / PLAN.PLAN_QTY, 2)END AS RATE_OP2110
	
FROM PRD, BAD, PLAN
	